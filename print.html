<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title></title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="src/custom.css">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="design.html">Pewpew design overview</a></li><li class="chapter-item expanded "><a href="config.html">Config file</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="config/config-section.html">config section</a></li><li class="chapter-item expanded "><a href="config/load_pattern-section.html">load_pattern section</a></li><li class="chapter-item expanded "><a href="config/vars-section.html">vars section</a></li><li class="chapter-item expanded "><a href="config/providers-section.html">providers section</a></li><li class="chapter-item expanded "><a href="config/loggers-section.html">loggers section</a></li><li class="chapter-item expanded "><a href="config/endpoints-section.html">endpoints section</a></li><li class="chapter-item expanded "><a href="config/common-types.html">Common types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="config/common-types/expressions.html">Expressions</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="cli.html">Command-line options</a></li><li class="chapter-item expanded "><a href="viewing-results.html">Viewing results</a></li><li class="chapter-item expanded "><a href="tuning.html">Tuning a machine</a></li><li class="chapter-item expanded "><a href="bug-report.html">Found a bug?</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>Pewpew is an HTTP load test tool designed for ease of use and high performance. Pewpew requires a minimal amount of resources to generate the maximum amount of load.</p>
<p>To get started:</p>
<ol>
<li><a href="./design.html">Learn</a> about Pewpew's design and unique concepts.</li>
<li>Download <a href="https://github.com/FamilySearch/pewpew/releases/latest">Pewpew</a>.</li>
<li>Create a <a href="./config.html">config file</a>.</li>
<li><a href="./cli.html">Execute</a> a test.</li>
<li><a href="./viewing-results.html">View</a> the results.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pewpew-design-overview"><a class="header" href="#pewpew-design-overview">Pewpew design overview</a></h1>
<p>The primary objective of an HTTP load test is to generate traffic against web services. A user of pewpew describes what HTTP endpoints to target, any <a href="design.html#data-flow">data flows</a> and the <a href="design.html#load-patterns-and-peak-loads">load patterns</a> for the test within a YAML <a href="./config.html">config file</a>.</p>
<h2 id="data-flow"><a class="header" href="#data-flow">Data flow</a></h2>
<p>Some endpoints only require a simple request, relying on no other source of data. In most cases, however, endpoints require particular data as part of the request--think ids or tokens. This is where <a href="./config/providers-section.html">providers</a> come in. Providers act as a <a href="https://en.wikipedia.org/wiki/FIFO_(computing_and_electronics)">FIFO (first in, first out) queue</a> for sending and receiving data. A provider can be fed with data from a file, a static list, a range of numbers and/or from HTTP responses.</p>
<p>The data within a provider is used to build HTTP requests. Here's a diagram of how data flows:</p>
<img class="diagram" src="./design/data-flows.svg" alt="The data flow in pewpew" />
<p>As an example, here's a visualization of a test which hits a single endpoint on a fictitious pepper service. (Note this diagram does not reflect the structure of the YAML config file, but merely demonstrates the logical flow of data out from and back into a provider):</p>
<img class="diagram" src="./design/provider-example.svg" alt="Example provider visualization" />
<p>On the left there is a single provider defined &quot;name&quot; which has some predefined values. In the &quot;endpoint definition&quot; the top box shows a template to build a request. Because the template references the &quot;name&quot; provider, for every request sent a single value will be popped off the &quot;name&quot; provider's queue. After the response is received the &quot;after response action&quot; will put the previously fetched value back onto the queue. In this example the very first request would look like:</p>
<pre><code>GET /pepper/cayenne
host: 127.0.0.1
user-agent: pewpew
</code></pre>
<p>After the response is received, the value &quot;cayenne&quot; would be pushed back into the &quot;name&quot; provider.</p>
<h2 id="peak-loads-and-load-patterns"><a class="header" href="#peak-loads-and-load-patterns">Peak loads and load patterns</a></h2>
<p>In most load tests it is desirable to not only generate considerable traffic but to do so in a defined pattern. Pewpew accomplishes this through the use of peak loads and load patterns. A peak load is defined for an endpoint and a load pattern can be defined test wide or on individual endpoints.</p>
<p><em><strong>peak load</strong></em> - how much load an endpoint should generate at &quot;100%&quot;. Peak loads are defined in terms of &quot;hits per minute&quot; (HPM) or &quot;hits per second&quot; (HPS).</p>
<p><em><strong>load pattern</strong></em> - the pattern that generated traffic will follow over time. Load patterns are termed in percentages over some duration.</p>
<p>For example, suppose we were creating a load test against the pepper service. After some research we determine that the peak load should be 50HPM (50 hits per minute) and that the load pattern should increase from 0% (no traffic) to 50% (25HPM) over 20 minutes, remain steady for 40 minutes, then go up to 100% (50HPM) over 10 minutes and stay there for 50 minutes.</p>
<p>Here's what the load pattern would look like charted out over time:</p>
<img class="diagram" src="./design/load-pattern-example.svg" alt="Example load pattern" /><div style="break-before: page; page-break-before: always;"></div><h1 id="config-file"><a class="header" href="#config-file">Config file</a></h1>
<p>A config file is a <a href="https://yaml.org/">YAML file</a> which defines everything needed for Pewpew to execute a load test. This includes which HTTP endpoints are part of the test, how load should fluctuate over the duration of a test, how data &quot;flows&quot; in a test and more.</p>
<h2 id="key-concepts"><a class="header" href="#key-concepts">Key concepts</a></h2>
<p>Before creating a config file there are a few key concepts which are helpful to understand.</p>
<ol>
<li>Everything in an HTTP load test is centered around endpoints, rather than &quot;transactions&quot;.</li>
<li>Whenever some piece of data is needed to build an HTTP request, that data flows through a <a href="./config/providers-section.html">provider</a>. Similarly, when an HTTP response provides data needed for another request that data goes through a provider.</li>
<li>The amount of load generated is determined on a per-endpoint-basis termed in &quot;hits per minute&quot; or &quot;hits per second&quot;, rather than number of &quot;users&quot;.</li>
<li>Because a config file is used rather than an API with a scripting language, Pewpew includes a minimal, build-in &quot;language&quot; which allows the execution of very simple <a href="./config/common-types/expressions.html">expressions</a>.</li>
</ol>
<p>Framing a load test with these concepts enables Pewpew to accomplish one of its goals of allowing a tester to create and maintain load tests with ease.</p>
<h2 id="sections-of-a-config-file"><a class="header" href="#sections-of-a-config-file">Sections of a config file</a></h2>
<p>A config file has five main sections, though not all are required:</p>
<ul>
<li><a href="./config/config-section.html">config</a> - Allows customization of various test options.</li>
<li><a href="./config/load_pattern-section.html">load_pattern</a> - Specifies how load fluctuates during a test.</li>
<li><a href="./config/vars-section.html">vars</a> - Declare static variables which can be used in expressions.</li>
<li><a href="./config/providers-section.html">providers</a> - Declares providers which will are used to manage the flow of data needed for a test.</li>
<li><a href="./config/loggers-section.html">loggers</a> - Declares loggers which, as their name suggests, provide a means of logging data.</li>
<li><a href="./config/endpoints-section.html">endpoints</a> - Specifies the HTTP endpoints which are part of a test and various parameters to build each request.</li>
</ul>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<p>Here's a simple example config file:</p>
<pre><code class="language-yaml">load_pattern:
  - linear:
      to: 100%
      over: 5m
  - linear:
      to: 100%
      over: 2m
endpoints:
  - method: GET
    url: http://localhost/foo
    peak_load: 42hpm
    headers:
      Accept: text/plain
  - method: GET
    url: http://localhost/bar
    headers:
      Accept-Language: en-us
      Accept: application/json
    peak_load: 15hps
</code></pre>
<h2 id="har-to-yaml-converter"><a class="header" href="#har-to-yaml-converter">Har to Yaml Converter</a></h2>
<p>If you are attempting to load test a specific web page or the resources on a web page, you can use the <a href="./results-viewer-react/yaml.html">Har to Yaml Converter</a>. First you need to create a <a href="https://docs.microsoft.com/en-us/azure/azure-portal/capture-browser-trace">Har File</a> from the page load, then use the <a href="./results-viewer-react/yaml.html">Converter</a> to generate a Yaml Config file.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="config-section"><a class="header" href="#config-section">config section</a></h1>
<pre>
config:
  client:
    [request_timeout: <i>duration</i>]
    [headers: <i>headers</i>]
    [keepalive: <i>duration</i>]
  general:
    [auto_buffer_start_size: <i>unsigned integer</i>]
    [bucket_size: <i>duration</i>]
    [log_provider_stats: <i>duration</i>]
    [watch_transition_time: <i>duration</i>]
</pre>
<p>The <code>config</code> section provides a means of customizing different parameters for the test. Parameters are divided into two subsections: <code>client</code> which pertains to customizations for the HTTP client and <code>general</code> which are other miscellaneous settings for the test.</p>
<h2 id="client"><a class="header" href="#client">client</a></h2>
<ul>
<li><strong><code>request_timeout</code></strong> <sub><sup><em>Optional</em></sup></sub> - A <a href="config/./common-types.html#duration">duration</a> signifying how long a request will wait for a response before it times out. Defaults to 60 seconds.</li>
<li><strong><code>headers</code></strong> <sub><sup><em>Optional</em></sup></sub> - <a href="config/./common-types.html#headers">Headers</a> which will be sent in every request. A header specified in an endpoint will override a header specified here with the same key.</li>
<li><strong><code>keepalive</code></strong> <sub><sup><em>Optional</em></sup></sub> - The keepalive <a href="config/./common-types.html#duration">duration</a> that will be used on TCP socket connections. This is different from the <code>Keep-Alive</code> HTTP header. Defaults to 90 seconds.</li>
</ul>
<h2 id="general"><a class="header" href="#general">general</a></h2>
<ul>
<li><strong><code>auto_buffer_start_size</code></strong> <sub><sup><em>Optional</em></sup></sub> - The starting size for provider buffers which are <code>auto</code> sized. Defaults to 5.</li>
<li><strong><code>bucket_size</code></strong> <sub><sup><em>Optional</em></sup></sub> - A <a href="config/./common-types.html#duration">duration</a> specifying how big each bucket should be for endpoints' aggregated stats. This also affects how often summary stats will be printed to the console. Defaults to 60 seconds.</li>
<li><strong><code>log_provider_stats</code></strong> <sub><sup><em>Optional</em></sup></sub> - A boolean that enables/disabled logging to the console stats about the providers. Stats include the number of items in the provider, the limit of the provider, how many tasks are waiting to send into the provider and how many endpoints are waiting to receive from the provider. Logs data at the <code>bucket_size</code> interval. Set to <code>false</code> to turn off and not log provider stats. Defaults to <code>true</code>.</li>
<li><strong><code>watch_transition_time</code></strong> <sub><sup><em>Optional</em></sup></sub> - A <a href="config/./common-types.html#duration">duration</a> specifying how long of a transition there should be when going from an old <code>load_pattern</code> to a new <code>load_pattern</code>. This option only has an affect when pewpew is running a load test with the <code>--watch</code> <a href="config/../cli.html">command-line</a> flag enabled. If this is not specified there will be no transition when <code>load_pattern</code>s change.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="load_pattern-section"><a class="header" href="#load_pattern-section">load_pattern section</a></h1>
<pre>
load_pattern:
  - <i>load_pattern_type</i>
      [parameters]
</pre>
<p>* If a root level <code>load_pattern</code> is not specified then each endpoint <em>must</em> specify its own <code>load_pattern</code>.</p>
<p>The <code>load_pattern</code> section defines the &quot;shape&quot; that the generated traffic will take over the course of the test. Individual endpoints can choose to specify their own <code>load_pattern</code> (see the <a href="config/./endpoints-section.html">endpoints section</a>).</p>
<p><code>load_pattern</code> is an array of <em>load_pattern_type</em>s specifying how generated traffic for a segment of the test will scale up, down or remain steady. Currently the only <em>load_pattern_type</em> is <code>linear</code>.</p>
<p>Example:</p>
<pre><code class="language-yaml">load_pattern:
  - linear:
      to: 100%
      over: 5m
  - linear:
      to: 100%
      over: 2m
</code></pre>
<h2 id="linear"><a class="header" href="#linear">linear</a></h2>
<p>The linear <em>load_pattern_type</em> allows generated traffic to increase or decrease linearly. There are three parameters which can be specified for each linear segment:</p>
<ul>
<li>
<p><strong><code>from</code></strong> <sub><sup><em>Optional</em></sup></sub> - A <a href="config/./common-types.html#templates%5D">template</a> indicating the starting point to scale from, specified as a percentage. Defaults to <code>0%</code> if the current segment is the first entry in <code>load_pattern</code>, or the <code>to</code> value of the previous segment otherwise. Only variables defined in the <a href="config/./vars-section.html">vars section</a> can be interopolated.</p>
<p>A valid percentage is any unsigned number, integer or decimal, immediately followed by the percent symbol (<code>%</code>). Percentages can exceed <code>100%</code> but cannot be negative. For example <code>15.25%</code> or <code>150%</code>. </p>
</li>
<li>
<p><strong><code>to</code></strong> - A <a href="config/./common-types.html#templates%5D">template</a> indicating the end point to scale to, specified as a percentage. Only variables defined in the <a href="config/./vars-section.html">vars section</a> can be interopolated.</p>
</li>
<li>
<p><strong><code>over</code></strong> - The <a href="config/./common-types.html#duration">duration</a> for how long the current segment should last.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="vars-section"><a class="header" href="#vars-section">vars section</a></h1>
<pre>
vars:
  <i>variable_name</i>: <i>definition</i>
</pre>
<p>Variables are used where a single pre-defined value is needed in the test a test. The variable <em>definition</em> can be any valid YAML type where any strings will be interpreted as a <a href="config/./common-types.html#templates">template</a>. In variable templates only environment variables can be interpolated in expressions.</p>
<p><strong>Examples</strong>:</p>
<pre><code class="language-yaml">vars:
  foo: bar
</code></pre>
<p>creates a single variabled named <code>foo</code> where the value is the string &quot;bar&quot;.</p>
<p>More complex values are automatically interpreted as JSON so the following:</p>
<pre><code class="language-yaml">vars:
  bar:
    a: 1
    b: 2
    c: 3
</code></pre>
<p>creates a variable named <code>bar</code> where the value is equivalent to the JSON <code>{&quot;a&quot;: 1, &quot;b&quot;: 2, &quot;c&quot;: 3}</code>.</p>
<p>As noted above, environment variables can be interpolated in the string templates. So, the following:</p>
<pre><code class="language-yaml">vars:
  password: ${PASSWORD}
</code></pre>
<p>would create a variable named <code>password</code> where the value comes from the environment variable <code>PASSWORD</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="providers-section"><a class="header" href="#providers-section">providers section</a></h1>
<pre>
providers:
  <i>provider_name</i>:
    <i>provider_type</i>:
      [parameters]
</pre>
<p>Providers are the means of providing data to an endpoint, including using data from the response of one endpoint in the request of another. The way providers handle data can be thought of as a FIFO queue--when an endpoint uses data from a provider it &quot;pops&quot; a value from the beginning of the queue and when an endpoint provides data to a provider it is &quot;pushed&quot; to the end of the queue. Every provider has an internal buffer with has a soft limit on how many items can be stored.</p>
<p>A <em>provider_name</em> is any string except for &quot;request&quot;, &quot;response&quot;, &quot;stats&quot; and &quot;for_each&quot;, which are reserved.</p>
<p>Example:</p>
<pre><code class="language-yaml">providers:
  session:
    response:
      auto_return: force
  username:
    file:
      path: &quot;usernames.csv&quot;
      repeat: true
</code></pre>
<p>There are four <em>provider_type</em>s: <a href="config/providers-section.html#file">file</a>, <a href="config/providers-section.html#response">response</a>, <a href="config/providers-section.html#list">list</a> and <a href="config/providers-section.html#range">range</a>.</p>
<h2 id="file"><a class="header" href="#file">file</a></h2>
<p>The <code>file</code> <em>provider_type</em> reads data from a file. Every line in the file is read as a value. In the future, the ability to specify the format of the data (csv, json, etc) may be implemented. A <code>file</code> provider has the following parameters:</p>
<ul>
<li>
<p><strong><code>path</code></strong> - A <a href="config/./common-types.html#templates">template</a> value indicating the path to the file on the file system. Unlike templates used elsewhere, only variables defined in the <a href="config/./vars-section.html">vars section</a> can be interopolated. When a relative path is specified it is interpreted as relative to the config file. Absolute paths are supported though discouraged as they prevent the config file from being platform agnostic.</p>
</li>
<li>
<p><strong><code>repeat</code></strong> - <sub><sup><em>Optional</em></sup></sub> A boolean value which when <code>true</code> indicates when the provider <code>file</code> provider gets to the end of the file it should start back at the beginning. Defaults to <code>false</code>.</p>
</li>
<li>
<p><strong><code>unique</code></strong> - <sub><sup><em>Optional</em></sup></sub> A boolean value which when <code>true</code> makes the provider a &quot;unique&quot; provider--meaning each item within the provider will be a unique JSON value without duplicates. Defaults to <code>false</code>.</p>
</li>
<li>
<p><strong><code>auto_return</code></strong> <sub><sup><em>Optional</em></sup></sub> - This parameter specifies that when this provider is used by a request, after a response is received the value is automatically returned to the provider. Valid options for this parameter are <code>block</code>, <code>force</code>, and <code>if_not_full</code>. See the <code>send</code> parameter under the <a href="config/./endpoints-section.html#provides-subsection">endpoints.provides subsection</a> for details on the effect of these options.</p>
</li>
<li>
<p><strong><code>buffer</code></strong> <sub><sup><em>Optional</em></sup></sub> - Specifies the soft limit for a provider's buffer. This can be indicated with an integer greater than zero or the value <code>auto</code>. The value <code>auto</code> indicates that the soft limit can increase as needed. This happens after a provider is full then later becomes empty. Defaults to <code>auto</code>.</p>
</li>
<li>
<p><strong><code>format</code></strong> <sub><sup><em>Optional</em></sup></sub> - Specifies the format for the file. The format can be one of <code>line</code> (the default), <code>json</code>, or <code>csv</code>.</p>
<p>The <code>line</code> format will read the file one line at a time with each line ending in a newline (<code>\n</code>) or a carriage return and a newline (<code>\r\n</code>). Every line will attempt to be parsed as JSON, but if it is not valid JSON it will be a string. Note that a JSON object which spans multiple lines in the file, for example, will not parse into a single object.</p>
<p>The <code>json</code> format will read the file as a stream of JSON values. Every JSON value must be self-delineating (an object, array or string), or must be separated by whitespace or a self-delineating value. For example, the following:</p>
<pre><code class="language-json">{&quot;a&quot;:1}{&quot;foo&quot;:&quot;bar&quot;}47[1,2,3]&quot;some text&quot;true 56
</code></pre>
<p>Would parse into separate JSON values of <code>{&quot;a&quot;: 1}</code>, <code>{&quot;foo&quot;: &quot;bar&quot;}</code>, <code>47</code>, <code>[1, 2, 3]</code>, <code>&quot;some text&quot;</code>, <code>true</code>, and <code>56</code>.</p>
<p>The <code>csv</code> format will read the file as a CSV file. Every non-header column will attempt to be parsed as JSON, but if it is not valid JSON it will be a string. The <code>csv</code> parameter allows customization over how the file should be parsed.</p>
</li>
<li>
<p><strong><code>csv</code></strong> <sub><sup><em>Optional</em></sup></sub> - When parsing a file using the <code>csv</code> format, this parameter provides extra customization on how the file should be parsed. This parameter is in the format of an object with key/value pairs. If the format is not <code>csv</code> this property will be ignored.
The following sub-parameters are available:</p>
<table>
<thead>
<tr>
<th>Sub-parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p>comment <sub><sup><em>Optional</em></sup></sub></p>
</td>
<td>
<p>Specifies a single-byte character which will mark a CSV record as a comment (ex. <code>#</code>). When not specified, no character is treated as a comment.</p>
</td>
</tr>
<tr>
<td>
<p>delimiter <sub><sup><em>Optional</em></sup></sub></p>
</td>
<td>
<p>Specifies a single-byte character used to separate columns in a record. Defaults to comma (<code>,</code>).</p>
</td>
</tr>
<tr>
<td>
<p>double_quote <sub><sup><em>Optional</em></sup></sub></p>
</td>
<td>
<p>A boolean that when enabled makes it so two quote characters can be used to escape quotes within a column. Defaults to <code>true</code>.</p>
</td>
</tr>
<tr>
<td>
<p>escape <sub><sup><em>Optional</em></sup></sub></p>
</td>
<td>
<p>Specifies a single-byte character which will be used to escape nested quote characters (ex. <code>\</code>). When not specified, escapes are disabled.</p>
</td>
</tr>
<tr>
<td>
<p>headers <sub><sup><em>Optional</em></sup></sub></p>
</td>
<td>
<p>Can be either a boolean value or a string. When a boolean, it indicates whether the first row in the file should be interpreted as column headers. When a string, the specified string is interpreted as a CSV record which is used for the column headers.</p>
<p>When headers are specified, each record served from the file will use the headers as keys for each column. When no headers are specified (the default), then each record will be returned as an array of values.</p>
<p>For example, with the following CSV file:</p>
<pre><code class="language-csv">id,name
0,Fred
1,Wilma
2,Pebbles
</code></pre>
<p>If <code>headers</code> was <code>true</code> than the following values would be provided (shown in JSON syntax): <code>{&quot;id&quot;: 0, name: &quot;Fred&quot;}</code>, <code>{&quot;id&quot;: 1, name: &quot;Wilma&quot;}</code>, and <code>{&quot;id&quot;: 3, name: &quot;Pebbles&quot;}</code>.</p>
<p>If <code>headers</code> was <code>false</code> than the following values would be provided: <code>[0, &quot;Fred&quot;]</code>, <code>[1, &quot;Wilma&quot;]</code>, and <code>[2, &quot;Pebbles&quot;]</code>.</p>
<p>If <code>headers</code> was <code>foo,bar</code> than the following values would be provided: <code>{&quot;foo&quot;: &quot;id&quot;, &quot;bar&quot;: &quot;name&quot;}</code>, <code>{&quot;foo&quot;: 0, &quot;bar&quot;: &quot;Fred&quot;}</code>, <code>{&quot;foo&quot;: 1, &quot;bar&quot;: &quot;Wilma&quot;}</code>, and <code>{&quot;foo&quot;: 3, &quot;bar&quot;: &quot;Pebbles&quot;}</code>.</p>
</td>
</tr>
<tr>
<td>
<p>terminator <sub><sup><em>Optional</em></sup></sub></p>
</td>
<td>
<p>Specifies a single-byte character used to terminate each record in the CSV file. Defaults to a special value where <code>\r</code>, <code>\n</code>, and <code>\r\n</code> are all accepted as terminators.</p>
<p>When specified, Pewpew becomes self-aware, unfolding a series of events which will ultimately lead to the end of the human race.</p>
</td>
</tr>
<tr>
<td>
<p>quote <sub><sup><em>Optional</em></sup></sub></p>
</td>
<td>
<p>Specifies a single-byte character that will be used to quote CSV columns. Defaults to the double-quote character (<code>&quot;</code>).</p>
</td>
</tr>
</tbody>
</table>
</li>
<li>
<p><strong><code>random</code></strong> <sub><sup><em>Optional</em></sup></sub> - A boolean indicating that each record in the file should be returned in random order. Defaults to <code>false</code>.</p>
<p>When enabled there is no sense of &quot;fairness&quot; in the randomization. Any record in the file could be used more than once before other records are used.</p>
</li>
</ul>
<p><strong>Example</strong>, the following:</p>
<pre><code class="language-yaml">providers:
  - username:
    - file:
      path: &quot;usernames.csv&quot;
      repeat: true
      random: true
</code></pre>
<h2 id="response"><a class="header" href="#response">response</a></h2>
<p>Unlike other <em>provider_type</em>s <code>response</code> does not automatically receive data from a source. Instead a <code>response</code> provider is available to be a &quot;sink&quot; for data originating from an HTTP response. The <code>response</code> provider has the following parameters.</p>
<ul>
<li><strong><code>auto_return</code></strong> <sub><sup><em>Optional</em></sup></sub> - This parameter specifies that when this provider is used and an individual endpoint call concludes, the value it got from this provider should be sent back to the provider. Valid options for this parameter are <code>block</code>, <code>force</code>, and <code>if_not_full</code>. See the <code>send</code> parameter under the <a href="config/./endpoints-section.html#provides-subsection">endpoints.provides subsection</a> for details on the effect of these options.</li>
<li><strong><code>buffer</code></strong> <sub><sup><em>Optional</em></sup></sub> - Specifies the soft limit for a provider's buffer. This can be indicated with an integer greater than zero or the value <code>auto</code>. The value <code>auto</code> indicates that if the provider's buffer becomes empty it will automatically increase the buffer size to help prevent the provider from becoming empty again in the future. Defaults to <code>auto</code>.</li>
<li><strong><code>unique</code></strong> - <sub><sup><em>Optional</em></sup></sub> A boolean value which when <code>true</code> makes the provider a &quot;unique&quot; provider--meaning each item within the provider will be a unique JSON value without duplicates. Defaults to <code>false</code>.</li>
</ul>
<p><strong>Example</strong>, the following:</p>
<pre><code class="language-yaml">providers:
  - session:
    - response:
        buffer: 1000
        auto_return: if_not_full
</code></pre>
<h2 id="list"><a class="header" href="#list">list</a></h2>
<p>The <code>list</code> <em>provider_type</em> creates a means of specifying an array of static values to be used as a provider.
A <code>list</code> provider can be specified in two forms, either implicitly or explicitly. The explicit form has the following parameters:</p>
<ul>
<li><strong><code>random</code></strong> <sub><sup><em>Optional</em></sup></sub> - A boolean indicating that entries in the values array should provided in random order. When combined with <code>repeat</code> there is no sense of &quot;fairness&quot; in the randomization. Defaults to <em>false</em>.</li>
<li><strong><code>repeat</code></strong> <sub><sup><em>Optional</em></sup></sub> - A boolean indicating that the array should repeat infitely. Defaults to <em>true</em>.</li>
<li><strong><code>values</code></strong> - An array of json values.</li>
<li><strong><code>unique</code></strong> - <sub><sup><em>Optional</em></sup></sub> A boolean value which when <code>true</code> makes the provider a &quot;unique&quot; provider--meaning each item within the provider will be a unique JSON value without duplicates. Defaults to <code>false</code>.</li>
</ul>
<p><strong>Example</strong>, the following:</p>
<pre><code class="language-yaml">providers:
  foo:
    list:
      - 123
      - 456
      - 789
</code></pre>
<p>is an example of an implicit <code>list</code> provider. It creates a <code>list</code> provider named <code>foo</code> where the first value provided will be <code>123</code>, the second <code>456</code>, third <code>789</code> then for subsequent values it will start over at the beginning.</p>
<p><strong>Example</strong>, the following:</p>
<pre><code class="language-yaml">providers:
  foo:
    list:
      values:
        - 123
        - 456
        - 789
      random: true
</code></pre>
<p>is an example of an explicit <code>list</code> provider. It creates a <code>list</code> provider named <code>foo</code> where the value provided will be randomized between the values listed.</p>
<h2 id="range"><a class="header" href="#range">range</a></h2>
<p>The <code>range</code> <em>provider_type</em> provides an incrementing sequence of numbers in a given range. A <code>range</code> provider takes three optional parameters.</p>
<ul>
<li><strong><code>start</code></strong> <sub><sup><em>Optional</em></sup></sub> - A whole number in the range of [-9223372036854775808, 9223372036854775807]. This indicates what the starting number should be for the range. Defaults to <code>0</code>.</li>
<li><strong><code>end</code></strong> <sub><sup><em>Optional</em></sup></sub> - A whole number in the range of [-9223372036854775808, 9223372036854775807]. This indicates what the end number should be for the range. This number is included in the range. Defaults to <code>9223372036854775807</code>.</li>
<li><strong><code>step</code></strong> <sub><sup><em>Optional</em></sup></sub> - A whole number in the range of [1, 65535]. This indicates how big each &quot;step&quot; in the range will be. Defaults to <code>1</code>.</li>
<li><strong><code>repeat</code></strong> <sub><sup><em>Optional</em></sup></sub> - A boolean which causes the range to repeat infinitely. Defaults to <code>false</code>.</li>
<li><strong><code>unique</code></strong> - <sub><sup><em>Optional</em></sup></sub> A boolean value which when <code>true</code> makes the provider a &quot;unique&quot; provider--meaning each item within the provider will be a unique JSON value without duplicates. Defaults to <code>false</code>.</li>
</ul>
<p><strong>Examples</strong>:</p>
<pre><code class="language-yaml">providers:
  foo:
    range: {}
</code></pre>
<p>Will use the default settings and <code>foo</code> will provide the values <code>0</code>, <code>1</code>, <code>2</code>, etc. until it yields the end number (<code>9223372036854775807</code>).</p>
<pre><code class="language-yaml">providers:
  foo:
    range:
      start: -50
      end: 100
      step: 2
</code></pre>
<p>In this case <code>foo</code> will provide the valuels <code>-50</code>, <code>-48</code>, <code>-46</code>, etc. until it yields <code>100</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="loggers-section"><a class="header" href="#loggers-section">loggers section</a></h1>
<pre>
loggers:
  <i>logger_name</i>:
    [select: <i>select</i>]
    [for_each: <i>for_each</i>]
    [where: <i>expression</i>]
    to: <i>template</i> | stderr | stdout
    [pretty: <i>boolean</i>]
    [limit: <i>integer</i>]
    [kill: <i>boolean</i>]
</pre>
<p>Loggers provide a means of logging data to a file, stderr or stdout. Any string can be used for <em>logger_name</em>.</p>
<p>There are two types of loggers: plain loggers which have data logged to them by explicitly referencing them within an <code>endpoints.log</code> subsection, and global loggers which are evaluated for every HTTP response.</p>
<p>In addition to the special variables &quot;request&quot;, &quot;response&quot; and &quot;stats&quot;, a logger also has access to a variable &quot;error&quot; which represents an error which happens during the test. It can be helpful to log such errors along with the request or response (if they are available) when diagnosing problems.</p>
<p>Loggers support the following parameters:</p>
<ul>
<li><strong><code>select</code></strong> <sub><sup><em>Optional</em></sup></sub> - When specified, the logger becomes a global logger. See the <a href="config/./endpoints-section.html#provides-subsection">endpoints.provides subsection</a> for details on how to define a <em>select</em>.</li>
<li><strong><code>for_each</code></strong> <sub><sup><em>Optional</em></sup></sub> - Used in conjunction with <code>select</code> on global loggers.  See the <a href="config/./endpoints-section.html#provides-subsection">endpoints.provides subsection</a> for details on how to define a <em>for_each</em>.</li>
<li><strong><code>where</code></strong> <sub><sup><em>Optional</em></sup></sub> - Used in conjunction with <code>select</code> on global loggers.  See the <a href="config/./endpoints-section.html#provides-subsection">endpoints.provides subsection</a> for details on how to define a where <em>expression</em>.</li>
<li><strong><code>to</code></strong> - A <a href="config/./common-types.html#templates">template</a> specifying where this logger will send its data. Unlike templates which can be used elsewhere, only variables defined in the <a href="config/./vars-section.html">vars section</a> can be interopolated. Values of &quot;stderr&quot; and &quot;stdout&quot; will log data to the respective process streams and any other string will log to a file with that name. When a file is specified, the file will be created if it does not exist or will be truncated if it already exists. When a relative path is specified it is interpreted as relative to the config file. Absolute paths are supported though discouraged as they prevent the config file from being platform agnostic.</li>
<li><strong><code>pretty</code></strong> <sub><sup><em>Optional</em></sup></sub> - A boolean that indicates the value logged will have added whitespace for readability. Defaults to <code>false</code>.</li>
<li><strong><code>limit</code></strong> <sub><sup><em>Optional</em></sup></sub> - An unsigned integer which indicates the logger will only log the first <em>n</em> values sent to it.</li>
<li><strong><code>kill</code></strong> <sub><sup><em>Optional</em></sup></sub> - A boolen that indicates the test will end when the <code>limit</code> is reached, or, if there is no limit, on the first message logged.</li>
</ul>
<p>Example:</p>
<pre><code class="language-yaml">loggers:
  httpErrors:
    select:
      request:
        - request[&quot;start-line&quot;]
        - request.headers
        - request.body
      response:
        - response[&quot;start-line&quot;]
        - response.headers
        - response.body
    where: response.status &gt;= 400
    limit: 5
    to: http_err.log
    pretty: true
</code></pre>
<p>Creates a global logger named &quot;httpErrors&quot; which will log to the file &quot;http_err.log&quot; the request and response of the first five requests which have an HTTP status of 400 or greater.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="endpoints-section"><a class="header" href="#endpoints-section">endpoints section</a></h1>
<pre>
endpoints:
  - [declare: <i>declare_subsection</i>]
    [headers: <i>headers</i>]
    [body: <i>body</i>]
    [load_pattern: <i>load_pattern_subsection</i>]
    [method: <i>method</i>]
    [peak_load: <i>peak_load</i>]
    [tags: <i>tags</i>]
    url: <i>template</i>
    [provides: <i>provides_subsection</i>]
    [on_demand: <i>boolean</i>]
    [logs: <i>logs_subsection</i>]
    [max_parallel_requests: <i>unsigned integer</i>]
    [no_auto_returns: <i>boolean</i>]
    [request_timeout: <i>duration</i>]
</pre>
<p>The <code>endpoints</code> section declares what HTTP endpoints will be called during a test.</p>
<ul>
<li>
<p><strong><code>declare</code></strong> <sub><sup><em>Optional</em></sup></sub> - See the <a href="config/endpoints-section.html#declare-subsection">declare subsection</a></p>
</li>
<li>
<p><strong><code>headers</code></strong> <sub><sup><em>Optional</em></sup></sub> - See <a href="config/./common-types.html#headers">headers</a></p>
</li>
<li>
<p><strong><code>body</code></strong> <sub><sup><em>Optional</em></sup></sub> - See the <a href="config/endpoints-section.html#body-subsection">body subsection</a></p>
</li>
<li>
<p><strong><code>load_pattern</code></strong> <sub><sup><em>Optional</em></sup></sub> - See the <a href="config/./load_pattern-section.html">load_pattern section</a></p>
</li>
<li>
<p><strong><code>method</code></strong> <sub><sup><em>Optional</em></sup></sub> - A string representation for a valid HTTP method verb. Defaults to <code>GET</code></p>
</li>
<li>
<p><strong><code>peak_load</code></strong> <sub><sup><em>Optional</em>*</sup></sub> - A <a href="config/./common-types.html#templates%5D">template</a> representing what the &quot;peak load&quot; for this endpoint should be. The term &quot;peak load&quot; represents how much traffic is generated for this endpoint when the <a href="config/./load_pattern-section.html">load_pattern</a> reaches <code>100%</code>. A <code>load_pattern</code> can go higher than <code>100%</code>, so a <code>load_pattern</code> of <code>200%</code>, for example, would mean it would go double the defined <code>peak_load</code>. Only variables defined in the <a href="config/./vars-section.html">vars section</a> can be interpolated.</p>
<p>* While <code>peak_load</code> is marked as <em>optional</em> that is only true if the current endpoint has a <em>provides_subsection</em>, and in that case this endpoint is called only as frequently as needed to keep the buffers of the providers it feeds full.</p>
<p>A valid <code>load_pattern</code> is a number--integer or decimal--followed by an optional space and the string &quot;hpm&quot; (meaning &quot;hits per minute&quot;) or &quot;hps&quot; (meaning &quot;hits per second&quot;).</p>
<p>Examples:</p>
<p><code>50hpm</code> - 50 hits per minute</p>
<p><code>300 hps</code> - 300 hits per second</p>
</li>
<li>
<p><strong><code>tags</code></strong> <sub><sup><em>Optional</em></sup></sub> - Key/value string/<a href="config/./common-types.html#templates">template</a> pairs.</p>
<p>Tags are a series of key/value pairs used to distinguish each endpoint. Tags can be used to include certain endpoints in a <a href="config/../cli.html#Command-line-options"><code>try</code></a> run, and also make it possible for a single endpoint to have its results statistics aggregated in multiple groups. Because tag values are <a href="config/./common-types.html#templates">templates</a> only tags which can be resolved statically at the beginning of a test can be used with the <code>include</code> flag of a <code>try</code> run. A reference to a provider can cause a single endpoint to have multiple groups of tags. Each one of these groups will have its own statistics in the results. For example if an endpoint had the following tags:</p>
<pre><code>  tags:
    name: Subscribe
    status: ${response.status}
</code></pre>
<p>A new group of aggregated stats will be created for every status code returned by the endpoint.</p>
<p>All endpoints have the following implicitly defined tags:</p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody>
<tr><td><code>method</code></td><td>The HTTP method for the endpoint.</td></tr>
<tr><td><code>url</code></td><td>The endpoint's url with any dynamic pieces being replaced with an asterisk.</td></tr>
<tr><td><code>_id</code></td><td>The index of this endpoint in the list of endpoints, starting with 0.</td></tr>
</tbody></table>
</div>
<p>Of the implicitly defined tags only <code>url</code> can be overwritten which is helpful in cases such as when an entire url is dynamically generated and it would otherwise show up as <code>*</code>.</p>
</li>
<li>
<p><strong><code>url</code></strong> - A <a href="config/./common-types.html#templates">template</a> specifying the fully qualified url to the endpoint which will be requested.</p>
</li>
<li>
<p><strong><code>provides</code></strong> <sub><sup><em>Optional</em></sup></sub> - See the <a href="config/endpoints-section.html#provides-subsection">provides subsection</a></p>
</li>
<li>
<p><strong><code>on_demand</code></strong> <sub><sup><em>Optional</em></sup></sub> - A boolean which indicates that this endpoint should only be called when another endpoint first needs data that this endpoint provides. If the endpoint has no <code>provides</code> it has no affect.</p>
</li>
<li>
<p><strong><code>logs</code></strong> <sub><sup><em>Optional</em></sup></sub> - See the <a href="config/endpoints-section.html#logs-subsection">logs subsection</a></p>
</li>
<li>
<p><strong><code>max_parallel_requests</code></strong> <sub><sup><em>Optional</em></sup></sub> - Limits how many requests can be &quot;open&quot; at any point for the endpoint. <em>WARNING</em>: this can cause coordinated omission, invalidating the test statistics.</p>
</li>
<li>
<p><strong><code>no_auto_returns</code></strong> <sub><sup><em>Optional</em></sup></sub> - A boolean which indicates that any <code>auto_return</code> providers referenced within this endpoint will have <code>auto_return</code> disabled--meaning values pulled from those providers will not be automatically pushed back to the provider after a response is received. Defaults to <code>false</code>.</p>
</li>
<li>
<p><strong><code>request_timeout</code></strong> <sub><sup><em>Optional</em></sup></sub> - A <a href="config/./common-types.html#duration">duration</a> signifying how long a request will wait for a response before it times out. When not specified, the value from the <a href="config/./config-section.html#client">client config</a> will be used.</p>
</li>
</ul>
<h2 id="using-providers-to-build-a-request"><a class="header" href="#using-providers-to-build-a-request">Using providers to build a request</a></h2>
<p>Providers can be referenced anywhere <a href="config/./common-types.html#templates">templates</a> can be used and also in the <code>declare</code> subsection.</p>
<h2 id="body-subsection"><a class="header" href="#body-subsection">body subsection</a></h2>
<pre>
body: <i>template</i>
</pre>
<pre>
body:
  file: <i>template</i>
</pre>
<pre>
body:
  multipart: 
    <i>field_name</i>:
      [headers: <i>headers</i>]
      body: <i>template</i>
    <i>field_name</i>:
      [headers: <i>headers</i>]
      body:
        file: <i>template</i>
</pre>
<p>A request body can be in one of three formats: a <a href="config/./common-types.html#templates">template</a> to send a string as the body, a file which will send the contents of a file as the body, or a multipart body.</p>
<p>To send the contents of a file the body parameter should be an object with a single key of <code>file</code> and the value being a template. Relative paths resolve relative to the config file used to execute pewpew.</p>
<p>To send a multipart body, the body parameter should be an object with a single key of <code>multipart</code> and the value being an object of key/value pairs, where each key/value pair represents a piece of the multipart body. The keys represent the <em>field_name</em>s used in an HTML form and the values are objects with the following properties:</p>
<ul>
<li><strong><code>headers</code></strong> <sub><sup><em>Optional</em></sup></sub> - <a href="config/./common-types.html#headers">Headers</a> that will be included with this piece of the multipart body. For example, it is not uncommon to include a <code>content-type</code> header with a piece of a multipart body which includes a file.</li>
<li><strong><code>body</code></strong> - Either a <a href="config/./common-types.html#templates">template</a> which will send a string value or an object with a single key of <code>file</code> and the value being a <a href="config/./common-types.html#templates">template</a>--which will send the contents of a file.</li>
</ul>
<p>When a multipart body is used for an endpoint each request will have the <code>content-type</code> header added with the value <code>multipart/form-data</code> and the necessary boundary. If there is already a <code>content-type</code> header set for the request it will be overwritten unless it is starts with <code>multipart/</code>--then the necessary boundary will be appended. If a <code>multipart/...</code> <code>content-type</code> is manually set with the request, make sure to not include a <code>boundary</code> parameter.</p>
<p>For any request which has a <code>content-type</code> of <code>multipart/form-data</code>, a <code>Content-Disposition</code> header will be added to each piece in the multipart body with a value of <code>form-data; name=&quot;<i>field_name</i>&quot;</code> (where <em>field_name</em> is substituted with the piece's <em>field_name</em>). If a <code>Content-Disposition</code> header is explicitly specified for a piece it will not be overwritten.</p>
<p>File example:</p>
<pre><code>body:
  file: a_file.txt
</code></pre>
<p>Multipart example:</p>
<pre><code>body:
  multipart:
    foo:
      headers:
        Content-Type: image/jpeg
      body:
        file: foo.jpg
    bar:
      body: some text
</code></pre>
<h2 id="declare-subsection"><a class="header" href="#declare-subsection">declare subsection</a></h2>
<pre>
declare:
  <i>name</i>: <i>expression</i>
</pre>
<p>A <em>declare_subsection</em> provides the ability to select multiple values from a single provider. Without using a <em>declare_subsection</em>, multiple references to a provider will only select a single value. For example, in:</p>
<pre><code class="language-yaml">endpoints:
  - method: PUT
    url: https://localhost/ship/${shipId}/speed
    body: '{&quot;shipId&quot;:&quot;${shipId}&quot;,&quot;kesselRunTime&quot;:75}'
</code></pre>
<p>both references to the provider <code>shipId</code> will resolve to the same value, which in many cases is desired.</p>
<p>The <em>declare_subsection</em> is in the format of key/value pairs where the value is an expression. Every key can function as a provider and can be interpolated just as a provider would be.</p>
<h3 id="example-1"><a class="header" href="#example-1">Example 1</a></h3>
<pre><code class="language-yaml">endpoints:
  - declare:
      shipIds: collect(shipId, 3, 5)
    method: DELETE
    url: https://localhost/ships
    body: '{&quot;shipIds&quot;:${shipIds}}'
</code></pre>
<p>Calls the endpoint <code>DELETE /ships</code> where the body is interpolated with an array of ship ids. <code>shipIds</code> will have a length between three and five.</p>
<h3 id="example-2"><a class="header" href="#example-2">Example 2</a></h3>
<pre><code class="language-yaml">endpoints:
  - declare:
      destroyedShipId: shipId
    method: PUT
    url: https://localhost/ship/${shipId}/destroys/${destroyedShipId}
</code></pre>
<p>Calls <code>PUT</code> on an endpoint where <code>shipId</code> and <code>destroyedShipId</code> are interpolated to different values.</p>
<h2 id="provides-subsection"><a class="header" href="#provides-subsection">provides subsection</a></h2>
<pre>
provides:
  <i>provider_name</i>:
    select: <i>select</i>
    [for_each: <i>for_each</i>]
    [where: <i>expression</i>]
    [send: block | force | if_not_full]
</pre>
<p>The <em>provides_subsection</em> is how data can be sent to a provider from an HTTP response. <em>provider_name</em> is a reference to a provider which must be declared in the root <a href="config/./providers-section.html">providers section</a>. For every HTTP response that is received, zero or more values can be sent to the provider based upon the conditions specified.</p>
<p>Sending data to a provider is done with a SQL-like syntax. The <code>select</code>, <code>for_each</code> and <code>where</code> sections use <a href="config/./common-types/expressions.html">expressions</a> to reference providers in addition to the special variables &quot;request&quot;, &quot;response&quot; and &quot;stats&quot;. &quot;request&quot; provides a means of accessing data that was sent with the request, &quot;response&quot; provides a means of accessing data returned with the response and &quot;stats&quot; give access to measurements about the request (currently only <code>rtt</code> meaning round-trip time).</p>
<p>The request object has the properties <code>start-line</code>, <code>method</code>, <code>url</code>, <code>headers</code>, <code>headers_all</code> and <code>body</code> which provide access to the respective sections in the HTTP request. Similarly, the response object has the properties <code>start-line</code>, <code>headers</code>, <code>headers_all</code> and <code>body</code> in addition to <code>status</code> which indicates the HTTP response status code. See <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Messages">this MDN article</a> on HTTP messages for more details on the structure of HTTP requests and responses.</p>
<p><code>start-line</code> is a string and <code>headers</code> is represented as a JSON object with key/value string pairs. In the event where a request or response has multiple headers with the same name, the <code>headers_all</code> property can be used which is a JSON object where the header name is the key and the value an array of header values. Currently, <code>body</code> in the request is always a string and <code>body</code> in the response is parsed as a JSON value, when possible, otherwise it is a string. <code>status</code> is a number. <code>method</code> is a string and <code>url</code> is an object with the same properties as the web URL object (see <a href="https://developer.mozilla.org/en-US/docs/Web/API/URL">this MDN article</a>). </p>
<ul>
<li>
<p><strong><code>select</code></strong> - Determines the shape of the data sent to the provider. <code>select</code> is interpreted as a JSON object where any string value is evaluated as an <a href="config/./common-types/expressions.html">expression</a>.</p>
</li>
<li>
<p><strong><code>for_each</code></strong> <sub><sup><em>Optional</em></sup></sub> - Evaluates <code>select</code> for each element in an array or arrays. This is specified as an array of <a href="config/./common-types/expressions.html">expressions</a>. Expressions can evaluate to any JSON data type, but those which evaluate to an array will have each of their elements iterated over and <code>select</code> is evaluated for each. When multiple expressions evaluate to an array then the cartesian product of the arrays is produced.</p>
<p>The <code>select</code> and <code>where</code> parameters can access the elements provided by <code>for_each</code> through the value <code>for_each</code> just like accessing a value from a provider. Because a <code>for_each</code> can iterate over multiple arrays, each element can be accessed by indexing into the array. For example <code>for_each[1]</code> would access the element from the second array (indexes are referenced with zero based counting so <code>0</code> represents the element in the first array).</p>
</li>
<li>
<p><strong><code>where</code></strong> <sub><sup><em>Optional</em></sup></sub> - Allows conditionally sending data to a provider based on a predicate. This is an <a href="config/./common-types/expressions.html">expression</a> which evaluates to a boolean value, indicating whether <code>select</code> should be evaluated for the current data set.</p>
</li>
<li>
<p><strong><code>send</code></strong> <sub><sup><em>Optional</em></sup></sub> - Specify the behavior that should be used when sending data to a provider. Valid options for this parameter are <code>block</code>, <code>force</code>, and <code>if_not_full</code>. Defaults to <code>if_not_full</code> if the endpoint has a <code>peak_load</code> otherwise <code>block</code>.</p>
<p><code>block</code> indicates that if the provider's buffer is full, further endpoint calls will be blocked until there's room in the provider's buffer for the value. If an endpoint has multiple provides which are <code>block</code>, then the blocking will only wait for at least one of the providers' buffers to have room.</p>
<p><code>force</code> indicates that the value will be sent to the provider regardless of whether its buffer is &quot;full&quot;. This can make a provider's buffer exceed its soft limit.</p>
<p><code>if_not_full</code> indicates that the value will be sent to the provider only if the provider is not full.</p>
</li>
</ul>
<h3 id="example-1-1"><a class="header" href="#example-1-1">Example 1</a></h3>
<p>With an HTTP response with the following body</p>
<pre><code class="language-json">{ &quot;session&quot;: &quot;abc123&quot; }
</code></pre>
<p>and a provides section defined as:</p>
<pre><code class="language-yaml">provides:
  session:
    select: response.body.session
    where: response.status &lt; 400
</code></pre>
<p>the <code>session</code> provider would be given the value <code>&quot;abc123&quot;</code> if the status code was less than 400 otherwise nothing would be sent to the <code>session</code> provider.</p>
<h3 id="example-2-1"><a class="header" href="#example-2-1">Example 2</a></h3>
<p>With an HTTP response with the following body:</p>
<pre><code class="language-json">{
  &quot;characters&quot;: [
    {
      &quot;type&quot;: &quot;Human&quot;,
      &quot;id&quot;: &quot;1000&quot;,
      &quot;name&quot;: &quot;Luke Skywalker&quot;,
      &quot;friends&quot;: [&quot;1002&quot;, &quot;1003&quot;, &quot;2000&quot;, &quot;2001&quot;],
      &quot;appearsIn&quot;: [4, 5, 6],
      &quot;homePlanet&quot;: &quot;Tatooine&quot;,
    },
    {
      &quot;type&quot;: &quot;Human&quot;,
      &quot;id&quot;: &quot;1001&quot;,
      &quot;name&quot;: &quot;Darth Vader&quot;,
      &quot;friends&quot;: [&quot;1004&quot;],
      &quot;appearsIn&quot;: [4, 5, 6],
      &quot;homePlanet&quot;: &quot;Tatooine&quot;,
    },
    {
      &quot;type&quot;: &quot;Droid&quot;,
      &quot;id&quot;: &quot;2001&quot;,
      &quot;name&quot;: &quot;R2-D2&quot;,
      &quot;friends&quot;: [&quot;1000&quot;, &quot;1002&quot;, &quot;1003&quot;],
      &quot;appearsIn&quot;: [4, 5, 6],
      &quot;primaryFunction&quot;: &quot;Astromech&quot;,
    }
  ]
}
</code></pre>
<p>and our provides section is defined as:</p>
<pre><code class="language-yaml">provides:
  names:
    select:
      name: for_each[0].name
    for_each:
      - response.body.characters
</code></pre>
<p>The <code>names</code> provider would be sent the following values: <code>{ &quot;name&quot;: &quot;Luke Skywalker&quot; }</code>, <code>{ &quot;name&quot;: &quot;Darth Vader&quot; }</code>, <code>{ &quot;name&quot;: &quot;R2-D2&quot; }</code>.</p>
<h3 id="example-3"><a class="header" href="#example-3">Example 3</a></h3>
<p>It is also possible to access the length of an array by accessing the <code>length</code> property.</p>
<p>Using the same response data from example 2, with a provides section defined as:</p>
<pre><code class="language-yaml">provides:
  friendsCount:
    select:
      id: for_each[0].id
      count: for_each[0].friends.length
    for_each:
      - response.body.characters
</code></pre>
<p>The <code>friendsCount</code> provider would be sent the following values: <code>{ &quot;id&quot;: 1000, &quot;count&quot;: 4 }</code>, <code>{ &quot;id&quot;: 1001, &quot;count&quot;: 1 }</code>, <code>{ &quot;id&quot;: 2001, &quot;count&quot;: 3 }</code>.</p>
<h2 id="logs-subsection"><a class="header" href="#logs-subsection">logs subsection</a></h2>
<pre>
logs:
  <i>logger_name</i>:
    select: <i>select</i>
    [for_each: <i>for_each</i>]
    [where: <i>expression</i>]
</pre>
<p>The <em>logs_subsection</em> provides a means of sending data to a logger based on the result of an HTTP response. <em>logger_name</em> is a reference to a logger which must be declared in the root <a href="config/./loggers-section.html">loggers section</a>. It is structured in the same way as the <a href="config/endpoints-section.html#provides-subsection"><em>provides_subsection</em></a> except there is no explicit <em>send</em> parameter. When data is sent to a logger it has the same behavior as <code>send: block</code>, which means logging data can potentially block further requests from happening if a logger were to get &quot;backed up&quot;. This is unlikely to be a problem unless a large amount of data was consistently logged. It is also possible to log to the same logger multiple times in a single endpoint by repeating the <em>logger_name</em> with a new <code>select</code>.</p>
<ul>
<li><strong><code>select</code></strong> - Determines the shape of the data sent into the logger.</li>
<li><strong><code>for_each</code></strong> <sub><sup><em>Optional</em></sup></sub> - Evaluates <code>select</code> for each element in an array or arrays.</li>
<li><strong><code>where</code></strong> <sub><sup><em>Optional</em></sup></sub> - Allows conditionally sending data into a logger based on a predicate.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="common-types"><a class="header" href="#common-types">Common types</a></h1>
<h2 id="duration"><a class="header" href="#duration">Duration</a></h2>
<p>A duration is an integer followed by an optional space and a string value indicating the time unit. Days can be specified with &quot;d&quot;, &quot;day&quot; or &quot;days&quot;, hours with &quot;h&quot;, &quot;hr&quot;, &quot;hrs&quot;, &quot;hour&quot; or &quot;hours&quot;, minutes with &quot;m&quot;, &quot;min&quot;, &quot;mins&quot;, &quot;minute&quot; or &quot;minutes&quot;, and seconds with &quot;s&quot;, &quot;sec&quot;, &quot;secs&quot;, &quot;second&quot; or &quot;seconds&quot;. Durations are <a href="config/common-types.html#templates">templates</a>, but can only be interpolated with variables defined in the <a href="config/./vars-section.html">vars section</a>.</p>
<p>Examples:</p>
<p><code>1h</code> = 1 hour</p>
<p><code>30 minutes</code> = 30 minutes</p>
<p>Multiple duration pieces can be chained together to form more complex durations.</p>
<p>Examples:</p>
<p><code>1h45m30s</code> = 1 hour, 45 minutes and 30 seconds</p>
<p><code>4 hrs 15 mins</code> = 4 hours and 15 minutes</p>
<p>As seen above an optional space can be used to delimit the individual duration pieces.</p>
<h2 id="headers"><a class="header" href="#headers">Headers</a></h2>
<p>Key/value pairs where the key is a string and the value is a <a href="config/common-types.html#templates">template</a> which specify the headers which will be sent with a request. Note that the <code>host</code> and <code>content-length</code> headers are added automatically to requests and any headers with the same name will be overwritten.</p>
<p>In an <a href="config/./endpoints-section.html">endpoints</a> <code>headers</code> sub-section, a YAML <code>null</code> can be specified as the value which will unset any global header with that name. Because HTTP specs allow a header to be specified multiple times in a request, to override a global header it is necessary to specify the header twice in the <a href="config/./endpoints-section.html">endpoints</a> <code>headers</code> sub-section, once with a <code>null</code> value and once with the new value. Not including the <code>null</code> value will mean the request will have the header specified twice.</p>
<p>For example:</p>
<pre><code class="language-yaml">endpoints:
  url: https://localhost/foo/bar
  headers:
    Authorization: Bearer ${sessionId}
</code></pre>
<p>specifies that an &quot;Authorization&quot; header will be sent with the request with a value of &quot;Bearer &quot; followed by a value coming from a provider named &quot;sessionId&quot;.</p>
<h2 id="templates"><a class="header" href="#templates">Templates</a></h2>
<p>Templates are special string values which can be interpolated with <a href="config/./common-types/expressions.html">expressions</a>. Interpolation is done by enclosing the <a href="config/./common-types/expressions.html">expression</a> in <code>${ }</code>. For example: <code>${foo}-bar</code> creates a string where a value from a provider named &quot;foo&quot; is interpolated before the string value <code>-bar</code>. <code>${join(baz, &quot;.&quot;)}</code> uses the <code>join</code> helper to create a string value derived from a value coming from the provider &quot;baz&quot;.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="expressions"><a class="header" href="#expressions">Expressions</a></h1>
<p>Expressions are like a mini-scripting language embedded within Pewpew. Expressions only deal with very limited data types--the JSON types--strings, numbers, booleans, null values, arrays and objects.</p>
<p>Expressions are most commonly used to access data from a provider (via <a href="config/common-types/../common-types.html#templates%5D">templates</a>) or to transform data from an HTTP response to be sent into a provider. Expressions allow the traversal of object and array structures, evaluating boolean logic and basic mathematic operators. Helper functions extend the functionality of expressions further.</p>
<h2 id="operators"><a class="header" href="#operators">Operators</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Operator</th><th>Description</th></tr></thead><tbody>
<tr><td><code>==</code></td><td>Equal. Check that two values are equal to each other and produces a boolean.</td></tr>
<tr><td><code>!=</code></td><td>Not equal. Check that two values are not equal to each other and produces a boolean.</td></tr>
<tr><td><code>&gt;</code></td><td>Greater than. Check that the left value is greater than the right and produces a boolean.</td></tr>
<tr><td><code>&lt;</code></td><td>Less than. Check that the left value is less than the right and produces a boolean.</td></tr>
<tr><td><code>&gt;=</code></td><td>Greater than or equal to. Check that the left value is greater than or equal to the right and produces a boolean.</td></tr>
<tr><td><code>&lt;=</code></td><td>Less than or equal to. Check that the left value is less than or equal to the right and produces a boolean.</td></tr>
<tr><td><code>&amp;&amp;</code></td><td>And. Checks that two values are true and produces a boolean.</td></tr>
<tr><td><code>||</code></td><td>Or. Checks that one of two values is true and produces a boolean.</td></tr>
<tr><td><code>+</code></td><td>Add. Adds two numbers together producing a number.</td></tr>
<tr><td><code>-</code></td><td>Subtract. Subtracts two numbers producing a number.</td></tr>
<tr><td><code>*</code></td><td>Multiply. Multiplies two numbers producing a number.</td></tr>
<tr><td><code>/</code></td><td>Divide. Divides two numbers producing a number.</td></tr>
<tr><td><code>%</code></td><td>Remainder. Provides the remainder after dividing two numbers.</td></tr>
</tbody></table>
</div>
<h2 id="helper-functions"><a class="header" href="#helper-functions">Helper functions</a></h2>
<table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><code>collect(<i>item</i>, <i>n</i>)</code></p>
<p>or</p>
<p><code>collect(<i>item</i>, <i>min</i>, <i>max</i>)</code>
</code></p>
</td>
<td>
<p>When used in a <a href="config/common-types/../endpoints-section.html#declare-subsection">endpoints.declare subsection</a> <code>collect</code> provides the special ability to &quot;collect&quot; multiple values from a provider into an array. <code>collect</code> can be called with two or three arguments. The two argument form creates an array of size <em>n</em>. The three argument form creates an array with a randomly selected size between <em>min</em> (inclusive) and <em>max</em> (exclusive).</p>
<p>When used outside a <a href="config/common-types/../endpoints-section.html#declare-subsection">declare subsection</a>, <code>collect</code> will simply return the <em>item</em>.</p>
<p>See the <a href="config/common-types/../endpoints-section.html#declare-subsection">endpoints.declare subsection</a> for an example.</p>
</td>
</tr>
<tr>
<td>
<code>encode(<i>value</i>, <i>encoding</i>)</code>
</td>
<td>
<p>Encode a string with the given encoding.</p>
<p><em>value</em> - any expression. The result of the expression will be coerced to a string if needed and then encoded with the specified encoding.<br/>
<em>encoding</em> - The encoding to be used. Encoding must be one of the following string literals:</p>
<ul>
<li><code>&quot;base64&quot;</code> - Base64 encodes the value.</li>
<li><code>&quot;percent-simple&quot;</code> - Percent encodes every ASCII character less than hexidecimal 20 and greater than 7E.</li>
<li><code>&quot;percent-query&quot;</code> - Percent encodes every ASCII character less than hexidecimal 20 and greater than 7E in addition to <code> </code>, <code>&quot;</code>, <code>#</code>, <code>&gt;</code> and <code>&lt;</code> (space, doublequote, hash, greater than, and less than).</li>
<li><code>&quot;percent&quot;</code> - Percent encodes every ASCII character less than hexidecimal 20 and greater than 7E in addition to <code> </code>, <code>&quot;</code>, <code>#</code>, <code>&gt;</code>, <code>&lt;</code>, <code>`</code>, <code>?</code>, <code>{</code> and <code>}</code> (space, doublequote, hash, greater than, less than, backtick, question mark, open curly brace and close curly brace).</li>
<li><code>&quot;percent-path&quot;</code> - Percent encodes every ASCII character less than hexidecimal 20 and greater than 7E in addition to <code> </code>, <code>&quot;</code>, <code>#</code>, <code>&gt;</code>, <code>&lt;</code>, <code>`</code>, <code>?</code>, <code>{</code>, <code>}</code>, <code>%</code> and <code>/</code> (space, doublequote, hash, greater than, less than, backtick, question mark, open curly brace, close curly brace, percent and forward slash).</li>
<li><code>&quot;percent-userinfo&quot;</code> - Percent encodes every ASCII character less than hexidecimal 20 and greater than 7E in addition to <code> </code>, <code>&quot;</code>, <code>#</code>, <code>&gt;</code>, <code>&lt;</code>, <code>`</code>, <code>?</code>, <code>{</code>, <code>}</code>, <code>/</code>, <code>:</code>, <code>;</code>, <code>=</code>, <code>@</code>, <code>\</code>, <code>[</code>, <code>]</code>, <code>^</code>, and <code>|</code> (space, doublequote, hash, greater than, less than, backtick, question mark, open curly brace, close curly brace, forward slash, colon, semi-colon, equal sign, at sign, backslash, open square bracket, close square bracket, caret and pipe).<br/><br/></li>
<li><code>&quot;non-alphanumeric&quot;</code> - Non-Alphanumeric encodes every ASCII character that is not an ASCII letter or digit.</li>
</ul>
<p><strong>Example</strong>: with the value <code>foo=bar</code> from a provider named <code>baz</code>, then the template <code>https://localhost/abc?${encode(baz, &quot;percent-userinfo&quot;}</code> would resolve to <code>https://localhost/abc?foo%3Dbar</code>.</p>
</td>
</tr>
<tr>
<td>
<code>end_pad(<i>value</i>, <i>min_length</i>, <i>pad_string</i>)</code>
</td>
<td>
<p>Pads a string or number to be minimum length. Any added padding will be added to the end of the string.</p>
<p><em>value</em> - An expression whose value will be coerced to a string if needed.<br/>
<em>min_length</em> - the minimum length, as a positive integer, that the returned string should be. If the first parameter in string format is less than this amount then padding will be added to it.<br/>
<em>pad_string</em> - The padding string to use. If the amount of padding needed is less than the length of this string then it will be truncated from the right. If the needed padding is more than the length of this string, then this string is repeated until it is long enough.</p>
<p><strong>Example</strong>: with the value <code>&quot;Jones&quot;</code> from a provider named <code>lastName</code>, then the string <code>${end_pad(lastName, 8, &quot;-&quot;)}</code> would resolve to <code>Jones---</code>.</p>
</td>
</tr>
<tr>
<td>
<code>entries(<i>value</i>)</code>
</td>
<td>
<p>Returns the &quot;entries&quot; which make up <em>value</em>. For an object this will yield the object's key/value pairs. For an array it yields the array's indices and elements. For a string it yields the indices and the characters. For boolean and null types it yields back those same values.</p>
<p><strong>Examples</strong></p>
<p>With the value <code>{&quot;a&quot;: {&quot;foo&quot;: &quot;bar&quot;, &quot;baz&quot;: 123}, &quot;b&quot;: [&quot;abc&quot;, &quot;def&quot;], &quot;c&quot;: &quot;xyz&quot;, &quot;d&quot;: null }</code> coming from a provider named <code>test</code>:</p>
<pre><code>entries(test.a)
</code></pre>
<p>would return <code>[[&quot;foo&quot;, &quot;bar&quot;], [&quot;baz&quot;, 123]]</code>.</p>
<pre><code>entries(test.b)
</code></pre>
<p>would return <code>[[0, &quot;abc&quot;], [1, &quot;def&quot;]]</code>.</p>
<pre><code>entries(test.c)
</code></pre>
<p>would return <code>[[0, &quot;x&quot;], [1, &quot;y&quot;], [2, &quot;z&quot;]]</code>.</p>
<pre><code>entries(test.d)
</code></pre>
<p>would return <code>null</code>.</p>
</td>
</tr>
<tr>
<td>
<code>epoch(<i>unit</i>)</code>
</td>
<td>
<p>Returns time since the unix epoch.</p>
<p><em>unit</em> - A string literal of <code>&quot;s&quot;</code> (seconds), <code>&quot;ms&quot;</code> (milliseconds), <code>&quot;mu&quot;</code> (microseconds), or <code>&quot;ns&quot;</code> (nanoseconds).</p>
</td>
</tr>
<tr>
<td><code>if(<i>check</i>, <i>true_value</i>, <i>false_value</i>)</code></td>
<td>
<p>Does a boolean check against the first argument, if true the second argument is returned otherwise the third argument is returned.</p>
<p><em>check</em> - An expression which will be coerced to a boolean if needed.<br/>
<em>true_value</em> - The value that is returned if <code>check</code> evaluates to true.<br/>
<em>false_value</em> - The value that is returned if <code>check</code> evaluates to false.<br/></p>
<p><strong>Example</strong>: <code>if(true, 1, 2)</code> would always resolve to <code>1</code>.</p>
</td>
</tr>
<tr>
<td>
<p><code>join(<i>value</i>, <i>separator</i>)</code></p>
<p>or</p>
<p><code>join(<i>value</i>, <i>separator</i>, <i>separator2</i>)</code></p>
</td>
<td>
<p>Turns an array of values into a string or turns an object into a string.</p>
<p><em>value</em> - any expression. When the expression resolves to an array, the elements of the array are coerced to a string if needed and are then joined together to a single string using the specified separator. When the <em>value</em> resolves to an object and the three argument variant is used then the object will be turned into a string with the specified separators. In any other case <em>value</em> is coerced to a string and returned.<br/>
<em>separator</em> - a string literal which will be used between each element in the array. In the case of the three argument variant when the first argument is an object <em>separator</em> is used to separate key/value pairs.<br/>
<em>separator2</em> - a string literal which is used to separate keys and values in an object.</p>
<p><strong>Examples</strong></p>
<p>With the value <code>[&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;]</code> from a provider named <code>qux</code>, then the template <code>https://localhost/some/thing?a=${join(qux, &quot;-&quot;)}</code> would resolve to <code>https://localhost/some/thing?a=foo-bar-baz</code>.</p>
<p>With the value <code>{&quot;a&quot;: 1, &quot;b&quot;: 2}</code> from a provider named <code>foo</code>, then the expression <code>join(foo, &quot;\n&quot;, &quot;: &quot;)</code> would resolve to the following string:</p>
<pre><code>a: 1
b: 2
</code></pre>
<p>or for an alternative, json-ified view: <code>&quot;a: 1\nb: 2&quot;</code></p>
</td>
</tr>
<tr>
<td>
<code>json_path(<i>query</i>)</code>
</td>
<td>
<p>Provides the ability to execute a <a href="https://goessner.net/articles/JsonPath/index.html">json path query</a> against an object and returns an array of values. The query must be a string literal.</p>
<p><strong>Example</strong>: <code>json_path(&quot;response.body.ships.*.ids&quot;)</code></p>
</td>
</tr>
<tr>
<td>
<code>match(<i>string</i>, <i>regex</i>)</code>
</td>
<td>
<p>Allows matching a string against a regex. Returns an object with the matches from the regex. Named matches are supported though any unnamed matches will be a number based on their position. Match <code>0</code> is always the portion of the string which the regex matched against. If the regex does not match <code>null</code> is returned.</p>
<p>If the first parameter is not a string it will be coerced into a string.</p>
<p>Regex look arounds are not supported.</p>
<p><strong>Example</strong>:</p>
<p>If a response body were the following:</p>
<pre><code>&lt;html&gt;
&lt;body&gt;
Hello, Jean! Today's date is 2038-01-19. So glad you made it!
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>Then the following expression:</p>
<pre><code>match(response.body, &quot;Hello, (?P&lt;name&gt;\w+).*(?P&lt;y&gt;\d{4})-(?P&lt;m&gt;\d{2})-(?P&lt;d&gt;\d{2})&quot;)
</code></pre>
<p>Would return:</p>
<pre><code>{
  &quot;0&quot;: &quot;Jean! Today's date is 2038-01-19&quot;,
  &quot;name&quot;: Jean&quot;,
  &quot;y&quot;: &quot;2038&quot;,
  &quot;m&quot;: &quot;01&quot;,
  &quot;d&quot;: &quot;19&quot;
}
</code></pre>
</td>
</tr>
<tr>
<td>
<p><code>max(<i>...number</i>)</code></p>
</td>
<td>
<p>Selects the largest number out of a sequence of numbers. Each argument should be an expression which resolves to a number otherwise it will not be considered in determining the min. If no arguments are provided, or if none of the arguments resolve to a number, then <code>null</code> will be returned.</p>
</td>
</tr>
<tr>
<td>
<p><code>min(<i>...number</i>)</code></p>
</td>
<td>
<p>Selects the smallest number out of a sequence of numbers. Each argument should be an expression which resolves to a number otherwise it will not be considered in determining the max. If no arguments are provided, or if none of the arguments resolve to a number, then <code>null</code> will be returned.</p>
</td>
</tr>
<tr>
<td>
<p><code>random(<i>start</i>, </i>end</i>)</code></p>
</td>
<td>
<p>Generates a random number between <em>start</em> (inclusive) and <em>end</em> (exclusive). Both <em>start</em> and <em>end</em> must be number literals. If both numbers are integers only integers will be generated within the specified range. If either number is a floating point number then a floating point number will be generated within the specified range.</p>
</td>
</tr>
<tr>
<td>
<p><code>range(<i>start</i>, </i>end</i>)</code></p>
</td>
<td>
<p>Creates an array of numeric values in the specified range.</p>
<p><em>start</em> - any expression resolving to a whole number. Represents the starting number for the range (inclusive).</p>
<p><em>end</em> - any expression resolving to a whole number. Represents the end number for the range (exclusive).</p>
<p><strong>Examples</strong>:</p>
<p><code>range(1, 10)</code></p>
<p><code>range(50, 1)</code></p>
</td>
</tr>
<tr>
<td>
<p><code>repeat(<i>n</i>)</code></p>
<p>or</p>
<p><code>repeat(<i>min</i>, </i>max</i>)</code></p>
</td>
<td>
<p>Creates an array of <code>null</code> values. The single argument version creates an array with a length of <em>n</em>. The three argument form creates an array with a randomly selected size between min (inclusive) and max (exclusive). This is mainly useful when used within a <code>for_each</code> to have the <code>select</code> expression evaluated multiple times.</p>
<p><strong>Example</strong>: <code>repeat(10)</code></p>
</td>
</tr>
<tr>
<td>
<code>start_pad(<i>value</i>, <i>min_length</i>, <i>pad_string</i>)</code>
</td>
<td>
<p>Pads a string or number to be minimum length. Any added padding will be added to the start of the string.</p>
<p><em>value</em> - an expression whose value will be coerced to a string if needed.<br/>
<em>min_length</em> - the minimum length, as a positive integer, that the returned string should be. If the first parameter in string format is less than this amount then padding will be added to it.<br/>
<em>pad_string</em> - The padding string to use. If the amount of padding needed is less than the length of this string then it will be truncated from the right. If the needed padding is more than the length of this string, then this string is repeated until it is long enough.</p>
<p><strong>Example</strong>: with the value <code>83</code> from a provider named <code>foo</code>, then the string <code>id=${start_pad(foo, 6, &quot;0&quot;)}</code> would resolve to <code>id=000083</code>.</p>
</td>
</tr>
<tr>
<td>
<code>replace(<i>needle</i>, <i>haystack</i>, <i>replacer</i>)</code>
</td>
<td>
<p>Replaces any instance of a string (<em>needle</em>) within a JSON value (<em>haystack</em>) with another string (<em>replacer</em>). This function will recursively check the JSON for any string value of <em>needle</em> and replace it with <em>replacer</em>. This includes checking within a nested object's key and value pairs, within arrays and within strings.</p>
<p><em>needle</em> - an expression whose value will be coerced to a string if needed.<br/>
<em>haystack</em> - the JSON value to search<br/>
<em>replacer</em> - an expression whose value will be coerced to a string if needed.<br/></p>
<p><strong>Example</strong>: with the value <code>{&quot;foo&quot;: &quot;baz&quot;, &quot;zed&quot;: [&quot;abc&quot;, 123, &quot;fooo&quot;]}</code> from a provider named <code>a</code>, then the expression <code>replace(&quot;foo&quot;, a, &quot;bar&quot;)</code> would resolve to <code>{&quot;bar&quot;: &quot;baz&quot;, &quot;zed&quot;: [&quot;abc&quot;, 123, &quot;baro&quot;]}</code>.</p>
</td>
</tr>
<tr>
<td>
<code>parseInt(<i>value</i>)</code>
</td>
<td>
<p>Converts a string or other value into an integer (<code>i64</code>). If the value cannot be converted to a number, then <code>null</code> will be returned.</p>
<p><em>value</em> - any expression. The result of the expression will be coerced to a string if needed and then converted.</p>
</td>
</tr>
<tr>
<td>
<code>parseFloat(<i>value</i>)</code>
</td>
<td>
<p>Converts a string or other value into an floating point number (<code>f64</code>). If the value cannot be converted to a number, then <code>null</code> will be returned.</p>
<p><em>value</em> - any expression. The result of the expression will be coerced to a string if needed and then converted.</p>
</td>
</tr>
</tbody>
</table><div style="break-before: page; page-break-before: always;"></div><h1 id="command-line-options"><a class="header" href="#command-line-options">Command-line options</a></h1>
<p>There are two ways that Pewpew can execute: either a full load test or a try run. For reference here's the output of <code>pewpew --help</code>:
<br/><br/></p>
<pre><code>The HTTP load test tool https://familysearch.github.io/pewpew

Usage: pewpew &lt;COMMANND&gt;

Commands:
  run    Runs a full load test
  try    Runs the specified endpoint(s) a single time for testing purposes
  help   Print this message or the help of the given subcommand(s)

Options:
  -h, --help       Prints help information
  -V, --version    Prints version information
</code></pre>
<p>As signified in the above help output, there are two subcommands <code>run</code> and <code>try</code>.
<br/><br/>
Here's the output of <code>pewpew run --help</code>:
<br/><br/></p>
<pre><code>Usage: pewpew run [OPTIONS] &lt;CONFIG&gt;

Arguments:
  &lt;CONFIG&gt;  Load test config file to use

Options:
  -f, --output-format &lt;FORMAT&gt;         Formatting for stats printed to stdout [default: human]
                                       [possible values: human, json]
  -d, --results-directory &lt;DIRECTORY&gt;  Directory to store results and logs
  -t, --start-at &lt;START_AT&gt;            Specify the time the test should start at
  -o, --stats-file &lt;STATS_FILE&gt;        Specify the filename for the stats file
  -s, --stats-file-format &lt;FORMAT&gt;     Format for the stats file [default: json]  [possible values:
                                       json]
  -w, --watch                          Watch the config file for changes and update the test
                                       accordingly
  -h, --help                           Prints help information
</code></pre>
<p>The <code>-f</code>, <code>--output-format</code> parameter allows changing the formatting of the stats which are printed to stdout.</p>
<p>The <code>-d</code>, <code>--results-directory</code> parameter will store the results file and any output logs in the specified directory. If the directory does not exist it is created.</p>
<p>The <code>-w</code>, <code>--watch</code> parameter makes pewpew watch the config file for changes. The <code>watch_transition_time</code> <a href="./config/config-section.html#general">general config option</a> allows specifying a transition time for switching to the new <code>load_pattern</code>s and <code>peak_load</code>s.</p>
<p>While any part of a test can be updated, special care should be made when modifying or removing endpoints. This is because the aggregation of statistics happens based upon the numerical index of where it appears in the config file. If, for example, the first endpoint is no longer needed and it is simply removed from the test, that means what was the second endpoint is now the first and all of the statistics for that endpoint will begin aggregating in with the first endpoint's statistics. An alternative approach to removing the endpoint would be to set the <code>peak_load</code> on the first endpoint to <code>0hpm</code>.
<br/><br/>
Here's the output of <code>pewpew try --help</code>:
<br/><br/></p>
<pre><code>Usage: pewpew try [OPTIONS] &lt;CONFIG&gt;

Arguments:
  &lt;CONFIG&gt;  Load test config file to use

Options:
  -o, --file &lt;FILE&gt;                    Send results to the specified file instead of stdout
  -f, --format &lt;FORMAT&gt;                Specify the format for the try run output [default: human]
                                       [possible values: human, json]
  -i, --include &lt;INCLUDE&gt;              Filter which endpoints are included in the try run. Filters
                                       work based on an endpoint's tags. Filters are specified in
                                       the format &quot;key=value&quot; where &quot;*&quot; is a wildcard. Any
                                       endpoint matching the filter is included in the test
  -l, --loggers                        Enable loggers defined in the config file
  -d, --results-directory &lt;DIRECTORY&gt;  Directory to store logs (if enabled with --loggers)
  -k, --skip-response-body             Skips reponse body from output (try command)
  -K, --skip-request-body              Skips request body from output (try command)
  -h, --help                           Prints help information
</code></pre>
<p>A try run will run one or more endpoints a single time and print out the raw HTTP requests and responses to stdout. By default all endpoints are included in the try run. This is useful for testing out a <a href="./config.html">config file</a> before running a full load test. When the <code>--include</code> parameter is used, pewpew will automatically include any other endpoints needed to provide data for the explicitly included endpoints.</p>
<p>The <code>-i</code>, <code>--include</code> parameter allows the filtering of which endpoints are included in the try run. Filtering works based on an endpoint's <code>tags</code> (see the <code>tags</code> parameter in the <a href="./config/endpoints-section.html">endpoints</a> section). The <code>INCLUDE</code> pattern is specified in the format <code>key=value</code> or <code>key!=value</code> and an asterisk <code>*</code> can be used as a wildcard. This parameter can be used multiple times to specify multiple patterns. An endpoint which matches any of the patterns is included in the try run.</p>
<p>The <code>-l</code>, <code>--loggers</code> flag specifies that any loggers defined in the config file should be enabled. By default, during a try run, loggers are disabled.</p>
<p>The <code>-d</code>, <code>--results-directory</code> parameter will store any log files (if the <code>--loggers</code> flag is used) in the specified directory. If the directory does not exist it is created.</p>
<p>The <code>-k</code>, <code>--skip-response-body</code> parameter ensures that during a Try run, the response bodies aren't displayed. This can be particularly useful for debugging responses when the body is very long and not crucial for the debugging process.</p>
<p>The <code>-K</code>, <code>--skip-request-body</code> parameter ensures that during a Try run, the request bodies aren't displayed. This can be particularly useful for debugging requests when the body is very long and not crucial for the debugging process.
<br/><br/></p>
<p>In both the <code>run</code> and <code>try</code> subcommands a <a href="./config.html">config file</a> is required.</p>
<h2 id="environment-variables"><a class="header" href="#environment-variables">environment variables</a></h2>
<p>While most environment variables are passed on to the <a href="./config/vars-section.html">vars</a> section of the <a href="./config.html">config</a> file, there are a few that affect the pewpew executable.</p>
<ul>
<li><strong><code>RUST_BACKTRACE</code></strong> <sub><sup><em>Optional</em></sup></sub> - Enable display of the stack backtrace on errors. Providing any parameter (other than falsey/0) will enable this. Examples. <code>RUST_BACKTRACE=1</code> or <code>RUST_BACKTRACE=full</code>.</li>
<li><strong><code>RUST_LOG</code></strong> <sub><sup><em>Optional</em></sup></sub> - A <a href="https://github.com/rust-lang/log/blob/master/src/lib.rs#L575">LevelFilter</a> specifying what level for pewpew to log at. Allowed values are <code>Off</code>, <code>Error</code>, <code>Warn</code>, <code>Info</code>, <code>Debug</code>, and <code>Trace</code>. Default is <code>Error</code>. See <a href="https://docs.rs/env_logger/0.9.0/env_logger/#enabling-logging">Enable Logging</a> for more complex options for <code>RUST_LOG</code>.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="viewing-results"><a class="header" href="#viewing-results">Viewing Results</a></h1>
<p>At the end of every test, Pewpew creates a <code>stats-*.json</code> file with aggregated statistics from the test. To view the stats:</p>
<ol>
<li>Go <a href="./results-viewer-react/index.html">here</a> to open the results viewer.</li>
<li>Drag the <code>stats-*.json</code> file onto the page.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tuning-a-machine-for-a-load-test"><a class="header" href="#tuning-a-machine-for-a-load-test">Tuning a machine for a load test</a></h1>
<h2 id="tuning-a-linux-machine"><a class="header" href="#tuning-a-linux-machine">Tuning a Linux machine</a></h2>
<p>To get maximum throughput on Linux consider the following tweaks. <em>NOTE</em>: These tweaks have been tested in Ubuntu 18.04 and may be different in other distributions.</p>
<p>Append the following to <code>/etc/sysctl.conf</code>:</p>
<pre><code>fs.file-max = 999999
net.ipv4.tcp_rmem = 4096 4096 16777216
net.ipv4.tcp_wmem = 4096 4096 16777216
net.ipv4.ip_local_port_range = 1024 65535
</code></pre>
<p>Append the following to <code>/etc/security/limits.conf</code>:</p>
<pre><code>*               -       nofile         999999
</code></pre>
<h2 id="tuning-a-windows-machine"><a class="header" href="#tuning-a-windows-machine">Tuning a Windows machine</a></h2>
<p>Using the registry editor, navigate to the following path:</p>
<p><code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\</code></p>
<p>Add (or edit if it exists) the entry <code>MaxUserPort</code> as a <code>DWORD</code> type and set the value as <code>65534</code> (decimal).</p>
<p>Alternatively, save the following as <code>port.reg</code> and run the file:</p>
<pre><code>Windows Registry Editor Version 5.00

[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters]
&quot;MaxUserPort&quot;=dword:0000fffe
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="found-a-bug"><a class="header" href="#found-a-bug">Found a bug?</a></h1>
<p>Before filing a new issue on <a href="https://github.com/FamilySearch/pewpew/issues">GitHub</a>, it is helpful to create a reproducible test case. To do that, please do the following:</p>
<ol>
<li>Remove all <code>endpoints</code>, <code>providers</code>, <code>loggers</code>, <code>vars</code>, <code>load_pattern</code>s and <code>config</code> options not needed to reproduce the issue.</li>
<li>When possible, replace <code>file</code> providers with a variable (<code>vars</code>) or a concise <code>list</code> provider. If the <code>file</code> provider is required to replicate the issue, make the file as small as possible.</li>
<li>Replace all references to environment variables with actual values in <code>vars</code>.</li>
<li>Change the remaining <code>endpoints</code> to run against the Pewpew test server (see below).</li>
<li>Reduce <code>peak_load</code>s and <code>load_pattern</code>s as much as possible while still reproducing the issue.</li>
</ol>
<h2 id="using-the-pewpew-test-server"><a class="header" href="#using-the-pewpew-test-server">Using the Pewpew test server</a></h2>
<p>The Pewpew test server provides a way to reproduce problems without generating load against others' servers. The test server is a simple, locally run HTTP server which is usually run from the same machine that Pewpew runs from.</p>
<p>To run the test server first download the latest test server binaries <a href="https://github.com/FamilySearch/pewpew/releases">here</a>, extract the archive and run the executable from the command-line. You should then see a message like:</p>
<pre><code>Listening on port 2073
</code></pre>
<p>The port the test server uses can be configured by setting the <code>PORT</code> environment variable. Here's an example run in bash:</p>
<pre><code class="language-bash">$ PORT=8080 ./test-server
Listening on port 8080
</code></pre>
<p>The test server provides a single HTTP endpoint:</p>
<ul>
<li>
<p><code>/</code> - this endpoint acts as an &quot;echo server&quot; and will return within the response body any data that was sent to it. This endpoint should only ever return a <code>200</code> or <code>204</code> status code. It accepts all HTTP methods though only <code>GET</code>, <code>POST</code> and <code>PUT</code> can echo data back in the response. For the <code>GET</code> method to echo data back, specify the echo data in the <code>echo</code> query parameter. For <code>POST</code> and <code>PUT</code> simply put the data to be echoed back in the request body. The response will use the same <code>Content-Type</code> header from the response when specified, otherwise it will use <code>text/plain</code>.</p>
<p>There is also an optional <code>wait</code> query parameter which defines a delay (specified in milliseconds) for how long the server should wait before responding.</p>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
